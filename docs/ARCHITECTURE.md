# Architecture Map

> Auto-generated by cartographer skill
> Last updated: 2026-01-18 17:30
> Project: GestioNeo | Type: Full-Stack (Node.js + React) | Version: 1.0.0

## Quick Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           GESTIONEO                                          â”‚
â”‚            Sistema de GestiÃ³n para Local de Hamburguesas                     â”‚
â”‚                     (POS + Inventory + Payroll)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                         FRONTEND                                     â”‚   â”‚
â”‚   â”‚                   React + Vite + Tailwind v4                         â”‚   â”‚
â”‚   â”‚                     http://localhost:5173                            â”‚   â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚   â”‚                                                                      â”‚   â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚   â”‚
â”‚   â”‚   â”‚   ADMIN    â”‚ â”‚    MOZO    â”‚ â”‚  COCINERO  â”‚ â”‚  DELIVERY  â”‚       â”‚   â”‚
â”‚   â”‚   â”‚ /dashboard â”‚ â”‚/mozo/mesas â”‚ â”‚  /cocina   â”‚ â”‚ /delivery/ â”‚       â”‚   â”‚
â”‚   â”‚   â”‚ /empleados â”‚ â”‚  /pedidos  â”‚ â”‚            â”‚ â”‚  pedidos   â”‚       â”‚   â”‚
â”‚   â”‚   â”‚ /productos â”‚ â”‚            â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚   â”‚
â”‚   â”‚   â”‚ /reportes  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     â”‚   â”‚
â”‚   â”‚   â”‚ /config    â”‚                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚   â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚   PUBLIC   â”‚                      â”‚   â”‚
â”‚   â”‚                                 â”‚   /menu    â”‚ (QR/Web)             â”‚   â”‚
â”‚   â”‚                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                  â”‚                                           â”‚
â”‚                                  â”‚ axios (HTTP + JWT)                        â”‚
â”‚                                  â–¼                                           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                          BACKEND                                     â”‚   â”‚
â”‚   â”‚                Node.js + Express + Prisma                            â”‚   â”‚
â”‚   â”‚                    http://localhost:3001                             â”‚   â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚   â”‚                                                                      â”‚   â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚   â”‚   â”‚   app.js   â”‚â”€â”€â”€â–¶â”‚  Middleware â”‚â”€â”€â”€â–¶â”‚        Routes           â”‚ â”‚   â”‚
â”‚   â”‚   â”‚  (entry)   â”‚    â”‚  (JWT Auth) â”‚    â”‚  /api/auth              â”‚ â”‚   â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  (Roles)    â”‚    â”‚  /api/pedidos           â”‚ â”‚   â”‚
â”‚   â”‚                     â”‚  (Helmet)   â”‚    â”‚  /api/productos         â”‚ â”‚   â”‚
â”‚   â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  /api/empleados         â”‚ â”‚   â”‚
â”‚   â”‚                                        â”‚  /api/ingredientes      â”‚ â”‚   â”‚
â”‚   â”‚                                        â”‚  /api/liquidaciones     â”‚ â”‚   â”‚
â”‚   â”‚                                        â”‚  /api/reportes          â”‚ â”‚   â”‚
â”‚   â”‚                                        â”‚  /api/pagos             â”‚ â”‚   â”‚
â”‚   â”‚                                        â”‚  /api/configuracion     â”‚ â”‚   â”‚
â”‚   â”‚                                        â”‚  /api/publico           â”‚ â”‚   â”‚
â”‚   â”‚                                        â”‚  /api/impresion         â”‚ â”‚   â”‚
â”‚   â”‚                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚   â”‚                                                    â”‚               â”‚   â”‚
â”‚   â”‚                                                    â–¼               â”‚   â”‚
â”‚   â”‚                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚   â”‚                                        â”‚      Controllers        â”‚ â”‚   â”‚
â”‚   â”‚                                        â”‚   (Business Logic)      â”‚ â”‚   â”‚
â”‚   â”‚                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚   â”‚                                                    â”‚               â”‚   â”‚
â”‚   â”‚                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚   â”‚                     â–¼                              â–¼          â–¼   â”‚   â”‚
â”‚   â”‚             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚   â”‚             â”‚   Prisma    â”‚    â”‚   Email     â”‚  â”‚MercadoP  â”‚    â”‚   â”‚
â”‚   â”‚             â”‚    ORM      â”‚    â”‚  Service    â”‚  â”‚  ago     â”‚    â”‚   â”‚
â”‚   â”‚             â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â”‚ (Nodemailer)â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚   â”‚                    â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                        â”‚                                                  â”‚
â”‚                        â–¼                                                  â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚
â”‚              â”‚    PostgreSQL    â”‚                                         â”‚
â”‚              â”‚    (Database)    â”‚                                         â”‚
â”‚              â”‚    + Supabase    â”‚  (Production with connection pooling)   â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚
â”‚                                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Directory Structure

```
GestioNeo/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ prisma/
â”‚   â”‚   â”œâ”€â”€ schema.prisma           # Database models & relations
â”‚   â”‚   â”œâ”€â”€ seed.js                 # Base seed (generic users)
â”‚   â”‚   â”œâ”€â”€ seed-ewald.js           # EstaciÃ³n Ewald products (38 products)
â”‚   â”‚   â”œâ”€â”€ seed-test-data.js       # Test data (users, orders, stock, etc.)
â”‚   â”‚   â””â”€â”€ migrations/             # Prisma migrations
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ app.js                  # Express entry point
â”‚   â”‚   â”œâ”€â”€ controllers/            # Request handlers
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.controller.js
â”‚   â”‚   â”‚   â”œâ”€â”€ pedidos.controller.js
â”‚   â”‚   â”‚   â”œâ”€â”€ productos.controller.js
â”‚   â”‚   â”‚   â”œâ”€â”€ mesas.controller.js
â”‚   â”‚   â”‚   â”œâ”€â”€ categorias.controller.js
â”‚   â”‚   â”‚   â”œâ”€â”€ empleados.controller.js
â”‚   â”‚   â”‚   â”œâ”€â”€ ingredientes.controller.js
â”‚   â”‚   â”‚   â”œâ”€â”€ fichajes.controller.js
â”‚   â”‚   â”‚   â”œâ”€â”€ liquidaciones.controller.js
â”‚   â”‚   â”‚   â”œâ”€â”€ reportes.controller.js
â”‚   â”‚   â”‚   â”œâ”€â”€ pagos.controller.js
â”‚   â”‚   â”‚   â”œâ”€â”€ configuracion.controller.js
â”‚   â”‚   â”‚   â””â”€â”€ impresion.controller.js
â”‚   â”‚   â”œâ”€â”€ routes/                 # API route definitions
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.routes.js
â”‚   â”‚   â”‚   â”œâ”€â”€ pedidos.routes.js
â”‚   â”‚   â”‚   â”œâ”€â”€ productos.routes.js
â”‚   â”‚   â”‚   â”œâ”€â”€ categorias.routes.js
â”‚   â”‚   â”‚   â”œâ”€â”€ mesas.routes.js
â”‚   â”‚   â”‚   â”œâ”€â”€ empleados.routes.js
â”‚   â”‚   â”‚   â”œâ”€â”€ ingredientes.routes.js
â”‚   â”‚   â”‚   â”œâ”€â”€ fichajes.routes.js
â”‚   â”‚   â”‚   â”œâ”€â”€ liquidaciones.routes.js
â”‚   â”‚   â”‚   â”œâ”€â”€ reportes.routes.js
â”‚   â”‚   â”‚   â”œâ”€â”€ pagos.routes.js
â”‚   â”‚   â”‚   â”œâ”€â”€ configuracion.routes.js
â”‚   â”‚   â”‚   â”œâ”€â”€ publico.routes.js   # Public menu & orders
â”‚   â”‚   â”‚   â””â”€â”€ impresion.routes.js
â”‚   â”‚   â”œâ”€â”€ middlewares/
â”‚   â”‚   â”‚   â””â”€â”€ auth.middleware.js  # JWT + verificarRol
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â””â”€â”€ email.service.js    # Nodemailer for order confirmations
â”‚   â”‚   â””â”€â”€ utils/                  # (placeholder)
â”‚   â”œâ”€â”€ uploads/                    # Product images + banners
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ .env
â”‚   â””â”€â”€ .env.example
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ main.jsx                # React entry point
â”‚   â”‚   â”œâ”€â”€ App.jsx                 # Router + ProtectedRoute
â”‚   â”‚   â”œâ”€â”€ index.css               # Tailwind v4 (@import + @theme)
â”‚   â”‚   â”œâ”€â”€ context/
â”‚   â”‚   â”‚   â””â”€â”€ AuthContext.jsx     # Auth state + role flags
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â””â”€â”€ api.js              # Axios instance
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ layouts/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ AdminLayout.jsx # Sidebar by role
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ PublicLayout.jsx
â”‚   â”‚   â”‚   â””â”€â”€ RedirectByRole.jsx  # Smart role-based redirect
â”‚   â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”‚   â”œâ”€â”€ Login.jsx
â”‚   â”‚   â”‚   â”œâ”€â”€ MenuPublico.jsx     # QR/Web menu with ordering
â”‚   â”‚   â”‚   â”œâ”€â”€ admin/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Dashboard.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Empleados.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Mesas.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Categorias.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Productos.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Ingredientes.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Liquidaciones.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Reportes.jsx    # Charts: donut, ranking
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Configuracion.jsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Pedidos.jsx
â”‚   â”‚   â”‚   â”œâ”€â”€ mozo/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ MozoMesas.jsx   # Table grid view
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ NuevoPedido.jsx # Order creation
â”‚   â”‚   â”‚   â”œâ”€â”€ cocina/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Cocina.jsx      # Kitchen display
â”‚   â”‚   â”‚   â””â”€â”€ delivery/
â”‚   â”‚   â”‚       â””â”€â”€ DeliveryPedidos.jsx
â”‚   â”‚   â”œâ”€â”€ hooks/                  # (placeholder)
â”‚   â”‚   â””â”€â”€ __tests__/
â”‚   â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ postcss.config.js           # @tailwindcss/postcss
â”‚   â”œâ”€â”€ vite.config.js
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ docs/
â”‚   â””â”€â”€ ARCHITECTURE.md             # This file
â””â”€â”€ DEPLOY.md                       # Deployment guide (Supabase + Railway + Vercel)
```

## Entry Points

| File | Purpose | Invocation |
|------|---------|------------|
| `backend/src/app.js` | Express API server | `npm run dev` |
| `frontend/src/main.jsx` | React application | `npm run dev` |
| `backend/prisma/seed.js` | Base database seeding | `npm run db:seed` |
| `backend/prisma/seed-ewald.js` | Load EstaciÃ³n Ewald products | `node prisma/seed-ewald.js` |
| `backend/prisma/seed-test-data.js` | Load test data | `node prisma/seed-test-data.js` |

## API Endpoints

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                             REST API                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                            â”‚
â”‚  Authentication                                                            â”‚
â”‚  â”œâ”€â”€ POST   /api/auth/login          # Login, returns JWT                 â”‚
â”‚  â”œâ”€â”€ POST   /api/auth/registrar      # Register (admin only)              â”‚
â”‚  â””â”€â”€ GET    /api/auth/perfil         # Get current user                   â”‚
â”‚                                                                            â”‚
â”‚  Pedidos (Orders)                                                          â”‚
â”‚  â”œâ”€â”€ GET    /api/pedidos             # List orders                        â”‚
â”‚  â”œâ”€â”€ GET    /api/pedidos/cocina      # Kitchen view (pending orders)      â”‚
â”‚  â”œâ”€â”€ POST   /api/pedidos             # Create order                       â”‚
â”‚  â”œâ”€â”€ PATCH  /api/pedidos/:id/estado  # Update order status               â”‚
â”‚  â””â”€â”€ POST   /api/pedidos/:id/items   # Add items to order                â”‚
â”‚                                                                            â”‚
â”‚  Productos & CategorÃ­as                                                    â”‚
â”‚  â”œâ”€â”€ GET    /api/categorias/publicas # Public menu (no auth)             â”‚
â”‚  â”œâ”€â”€ CRUD   /api/categorias          # Category management               â”‚
â”‚  â””â”€â”€ CRUD   /api/productos           # Product management                â”‚
â”‚                                                                            â”‚
â”‚  Inventario                                                                â”‚
â”‚  â”œâ”€â”€ CRUD   /api/ingredientes        # Ingredients management            â”‚
â”‚  â”œâ”€â”€ GET    /api/ingredientes/alertas # Low stock alerts                 â”‚
â”‚  â””â”€â”€ POST   /api/ingredientes/:id/movimiento  # Stock movements          â”‚
â”‚                                                                            â”‚
â”‚  Empleados & Sueldos                                                       â”‚
â”‚  â”œâ”€â”€ CRUD   /api/empleados           # Employee management               â”‚
â”‚  â”œâ”€â”€ POST   /api/fichajes/entrada    # Clock in                          â”‚
â”‚  â”œâ”€â”€ POST   /api/fichajes/salida     # Clock out                         â”‚
â”‚  â”œâ”€â”€ POST   /api/liquidaciones/calcular  # Calculate payroll             â”‚
â”‚  â””â”€â”€ POST   /api/liquidaciones       # Create payroll record             â”‚
â”‚                                                                            â”‚
â”‚  Pagos & Reportes                                                          â”‚
â”‚  â”œâ”€â”€ POST   /api/pagos               # Register payment                  â”‚
â”‚  â”œâ”€â”€ POST   /api/pagos/webhook/mercadopago  # MP webhook (public)        â”‚
â”‚  â””â”€â”€ GET    /api/reportes/*          # Sales, inventory, payroll reports â”‚
â”‚                                                                            â”‚
â”‚  ConfiguraciÃ³n                                                             â”‚
â”‚  â”œâ”€â”€ GET    /api/configuracion       # Get all config (admin)            â”‚
â”‚  â”œâ”€â”€ PUT    /api/configuracion/:clave # Update single config             â”‚
â”‚  â”œâ”€â”€ PUT    /api/configuracion       # Bulk update                       â”‚
â”‚  â””â”€â”€ POST   /api/configuracion/banner # Upload banner image              â”‚
â”‚                                                                            â”‚
â”‚  PÃºblico (No auth required)                                                â”‚
â”‚  â”œâ”€â”€ GET    /api/publico/config      # Public store config               â”‚
â”‚  â”œâ”€â”€ GET    /api/publico/menu        # Public menu (categories+products) â”‚
â”‚  â”œâ”€â”€ POST   /api/publico/pedido      # Create public order               â”‚
â”‚  â”œâ”€â”€ GET    /api/publico/pedido/:id  # Get order status                  â”‚
â”‚  â””â”€â”€ POST   /api/publico/pedido/:id/pagar  # Init MercadoPago payment   â”‚
â”‚                                                                            â”‚
â”‚  ImpresiÃ³n                                                                 â”‚
â”‚  â”œâ”€â”€ POST   /api/impresion/comanda/:id  # Print ticket (3 copies)        â”‚
â”‚  â””â”€â”€ GET    /api/impresion/comanda/:id/preview  # Preview ticket         â”‚
â”‚                                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Database Schema

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           PostgreSQL Database                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚   â”‚   Usuario    â”‚                    â”‚   Empleado   â”‚                      â”‚
â”‚   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                      â”‚
â”‚   â”‚ id           â”‚                    â”‚ id           â”‚                      â”‚
â”‚   â”‚ email        â”‚                    â”‚ nombre       â”‚                      â”‚
â”‚   â”‚ password     â”‚                    â”‚ dni          â”‚                      â”‚
â”‚   â”‚ nombre       â”‚                    â”‚ rol          â”‚                      â”‚
â”‚   â”‚ rol          â”‚                    â”‚ tarifaHora   â”‚                      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚          â”‚                                   â”‚                               â”‚
â”‚          â”‚ 1:N                               â”‚ 1:N                           â”‚
â”‚          â–¼                                   â–¼                               â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚    Pedido    â”‚                    â”‚   Fichaje    â”‚   â”‚ Liquidacion  â”‚  â”‚
â”‚   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚
â”‚   â”‚ id           â”‚                    â”‚ entrada      â”‚   â”‚ horasTotales â”‚  â”‚
â”‚   â”‚ tipo         â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ salida       â”‚   â”‚ totalPagar   â”‚  â”‚
â”‚   â”‚ estado       â”‚         N:1        â”‚ fecha        â”‚   â”‚ pagado       â”‚  â”‚
â”‚   â”‚ estadoPago   â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚   â”‚ origen       â”‚  (INTERNO/MENU_PUBLICO)                                 â”‚
â”‚   â”‚ total        â”‚                                                          â”‚
â”‚   â”‚ mesaId?      â”‚                                                          â”‚
â”‚   â”‚ clienteEmail?â”‚                                                          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                                          â”‚
â”‚          â”‚                                                                   â”‚
â”‚          â”‚ 1:N                                                               â”‚
â”‚          â–¼                                                                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚   â”‚  PedidoItem  â”‚      â”‚   Producto   â”‚      â”‚  Categoria   â”‚             â”‚
â”‚   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚             â”‚
â”‚   â”‚ cantidad     â”‚â”€â”€â”€â”€â”€â–¶â”‚ nombre       â”‚â”€â”€â”€â”€â”€â–¶â”‚ nombre       â”‚             â”‚
â”‚   â”‚ observacionesâ”‚  N:1 â”‚ precio       â”‚  N:1 â”‚ orden        â”‚             â”‚
â”‚   â”‚ precioUnit   â”‚      â”‚ disponible   â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ destacado    â”‚                                   â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚                                â”‚                                            â”‚
â”‚                                â”‚ N:M                                        â”‚
â”‚                                â–¼                                            â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚                         â”‚  Producto    â”‚      â”‚ Ingrediente  â”‚             â”‚
â”‚                         â”‚ Ingrediente  â”‚â”€â”€â”€â”€â”€â–¶â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚             â”‚
â”‚                         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  N:1 â”‚ stockActual  â”‚             â”‚
â”‚                         â”‚ cantidad     â”‚      â”‚ stockMinimo  â”‚             â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                      â”‚                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚ 1:N                  â”‚
â”‚   â”‚     Mesa     â”‚      â”‚     Pago     â”‚            â–¼                      â”‚
â”‚   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚   â”‚ numero       â”‚      â”‚ monto        â”‚     â”‚ Movimiento   â”‚             â”‚
â”‚   â”‚ zona         â”‚      â”‚ metodo       â”‚     â”‚    Stock     â”‚             â”‚
â”‚   â”‚ estado       â”‚      â”‚ estado       â”‚     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚             â”‚
â”‚   â”‚ capacidad    â”‚      â”‚ mpPreference â”‚     â”‚ tipo         â”‚             â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ mpPaymentId  â”‚     â”‚ cantidad     â”‚             â”‚
â”‚                         â”‚ idempotency  â”‚     â”‚ motivo       â”‚             â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                          â”‚
â”‚   â”‚Configuracion â”‚  (clave/valor store for system settings)                â”‚
â”‚   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                                                          â”‚
â”‚   â”‚ clave        â”‚  tienda_abierta, costo_delivery, nombre_local,          â”‚
â”‚   â”‚ valor        â”‚  telefono, direccion, mercadopago_enabled, banner_url   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                          â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow

### Order Creation Flow (Internal)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Mozo   â”‚â”€â”€â”€â–¶â”‚  Carrito â”‚â”€â”€â”€â–¶â”‚   API    â”‚â”€â”€â”€â–¶â”‚  Prisma  â”‚â”€â”€â”€â–¶â”‚    DB    â”‚
â”‚  (React) â”‚    â”‚  (state) â”‚    â”‚  /pedido â”‚    â”‚  create  â”‚    â”‚ (Pedido) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                               â”‚Impresion â”‚â”€â”€â”€â–¶â”‚ ESC/POS  â”‚ Ã— 3 copias
                               â”‚Controllerâ”‚    â”‚ Printer  â”‚ (cocina/caja/cliente)
                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Public Order Flow (Menu QR)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Customer â”‚â”€â”€â”€â–¶â”‚ /menu    â”‚â”€â”€â”€â–¶â”‚ /publico â”‚â”€â”€â”€â–¶â”‚  Pedido  â”‚
â”‚  (Phone) â”‚    â”‚  (React) â”‚    â”‚  /pedido â”‚    â”‚ origen=  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â”‚MENU_PUBL â”‚
                     â”‚               â”‚          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                     â–¼               â–¼               â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
              â”‚MercadoPa â”‚â—€â”€â”€â”€â”‚ /pagar   â”‚          â”‚
              â”‚   go     â”‚    â”‚ endpoint â”‚          â”‚
              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
                   â”‚                                 â”‚
                   â–¼                                 â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Webhook  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  Pago    â”‚
              â”‚ callback â”‚                    â”‚ APROBADO â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                    â”‚
                                                    â–¼
                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                              â”‚  Email   â”‚
                                              â”‚ Service  â”‚ (confirmation)
                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Order Status Flow

```
PENDIENTE â”€â”€â–¶ EN_PREPARACION â”€â”€â–¶ LISTO â”€â”€â–¶ ENTREGADO â”€â”€â–¶ COBRADO
    â”‚                                                        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ CANCELADO â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Stock Deduction Flow

```
Pedido.estado = EN_PREPARACION
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ For each PedidoItem:    â”‚
â”‚   For each Ingrediente: â”‚
â”‚     - Decrement stock   â”‚
â”‚     - Create Movimiento â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## User Roles & Permissions

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Role    â”‚ Dashboard â”‚      Pedidos       â”‚ Inventar  â”‚ Empleados â”‚ Reportes  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ADMIN   â”‚     âœ“     â”‚ Todo               â”‚     âœ“     â”‚     âœ“     â”‚     âœ“     â”‚
â”‚   MOZO    â”‚     -     â”‚ Crear + ENTREGADO  â”‚     -     â”‚     -     â”‚     -     â”‚
â”‚  COCINERO â”‚     âœ“     â”‚ Cocina (estados)   â”‚     -     â”‚     -     â”‚     -     â”‚
â”‚   CAJERO  â”‚     âœ“     â”‚ Cobrar + estados   â”‚     -     â”‚     -     â”‚     âœ“     â”‚
â”‚  DELIVERY â”‚     -     â”‚ Solo delivery      â”‚     -     â”‚     -     â”‚     -     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Detalle de permisos MOZO:
- NO ve Dashboard
- Puede crear pedidos
- Solo puede cambiar estado a ENTREGADO (cuando entrega a mesa)
- NO puede registrar pagos
- NO puede cambiar a EN_PREPARACION ni LISTO

Detalle de permisos DELIVERY:
- Solo ve /delivery/pedidos
- Solo ve pedidos tipo DELIVERY
- Solo puede marcar como ENTREGADO
```

## Role-Based Redirects

```
Login exitoso:
  â”œâ”€â”€ ADMIN    â”€â”€â–¶ /dashboard
  â”œâ”€â”€ MOZO     â”€â”€â–¶ /mozo/mesas
  â”œâ”€â”€ COCINERO â”€â”€â–¶ /cocina
  â”œâ”€â”€ CAJERO   â”€â”€â–¶ /dashboard
  â””â”€â”€ DELIVERY â”€â”€â–¶ /delivery/pedidos
```

## Key Files

| File | Responsibility | Read Before |
|------|----------------|-------------|
| `backend/prisma/schema.prisma` | Database models | Any DB changes |
| `backend/src/middlewares/auth.middleware.js` | JWT + Role verification | Auth changes |
| `backend/src/controllers/pedidos.controller.js` | Order logic | Order flow changes |
| `backend/src/routes/publico.routes.js` | Public menu & ordering | Public API changes |
| `backend/src/services/email.service.js` | Order confirmation emails | Email changes |
| `frontend/src/context/AuthContext.jsx` | Global auth state | Auth UI changes |
| `frontend/src/App.jsx` | Route definitions | Adding pages |
| `frontend/src/pages/admin/Reportes.jsx` | Charts & analytics | Report changes |

## External Dependencies

| Service | Purpose | Config Location |
|---------|---------|-----------------|
| PostgreSQL | Primary database | `DATABASE_URL` in `.env` |
| Supabase | Production database (with pgbouncer) | `DATABASE_URL` + `DIRECT_URL` |
| MercadoPago | Payment processing | `MERCADOPAGO_ACCESS_TOKEN` |
| Nodemailer | Order confirmation emails | SMTP config in email.service.js |
| ESC/POS Printer | Thermal printing | USB connection |

## Environment Variables

```bash
# Backend (.env)
PORT=3001
NODE_ENV=development

# Database (local)
DATABASE_URL="postgresql://user:pass@localhost:5432/gestioneo?schema=public"
DIRECT_URL="postgresql://user:pass@localhost:5432/gestioneo?schema=public"

# Database (Supabase production)
# DATABASE_URL="postgresql://postgres.xxx:PASS@aws.pooler.supabase.com:6543/postgres?pgbouncer=true"
# DIRECT_URL="postgresql://postgres.xxx:PASS@aws.pooler.supabase.com:5432/postgres"

# JWT
JWT_SECRET="your-secret-key"
JWT_EXPIRES_IN="24h"

# Payments
MERCADOPAGO_ACCESS_TOKEN="TEST-xxx"
MERCADOPAGO_PUBLIC_KEY="TEST-xxx"

# CORS
FRONTEND_URL="http://localhost:5173"
```

## Deployment

See `DEPLOY.md` for full deployment guide.

| Service | Provider | Cost |
|---------|----------|------|
| Database | Supabase | Free tier (sufficient for 100 orders/day) |
| Backend | Railway | ~$5/month |
| Frontend | Vercel | Free tier |

## Notes for Agents

### Conventions
- Backend: CommonJS modules (`require`/`module.exports`)
- Frontend: ES Modules (`import`/`export`)
- API responses: `{ data }` or `{ error: { message } }`
- Dates: ISO 8601 format
- Money: Decimal with 2 places (Prisma `Decimal(10,2)`)

### Gotchas
- Stock deduction happens on `EN_PREPARACION`, not on order creation
- Mesa status changes automatically with order states
- Public routes (`/menu`, `/api/publico/*`) don't require auth
- Webhook endpoint `/api/pagos/webhook/mercadopago` is public
- **MOZO solo puede cambiar estado a ENTREGADO** (validado en backend)
- **MOZO no ve boton de pago** (ocultado en frontend)
- Tailwind v4 usa `@import "tailwindcss"` y `@theme` en index.css
- No hay tailwind.config.js - usa postcss.config.js con @tailwindcss/postcss
- Supabase requires `directUrl` in Prisma schema for migrations
- `ventasPorMozo` report handles null `usuarioId` (from public orders) as "MenÃº PÃºblico"

### Warnings
- `JWT_SECRET` must be changed in production
- Image uploads go to `backend/uploads/` - not persisted in containers
- Printer integration requires local USB connection
- MercadoPago webhooks require public URL (use ngrok for local testing)

### Testing
```bash
# Backend
cd backend
npm run dev                    # Start API on :3001

# Seed database
node prisma/seed-ewald.js      # Load EstaciÃ³n Ewald products
node prisma/seed-test-data.js  # Load test data

# Frontend
cd frontend
npm run dev                    # Start React on :5173

# Test users (EstaciÃ³n Ewald)
admin@ewald.com / 123456       # ADMIN - full access
mozo1@ewald.com / 123456       # MOZO - table service
mozo2@ewald.com / 123456       # MOZO - table service
cocina@ewald.com / 123456      # COCINERO - kitchen display
caja@ewald.com / 123456        # CAJERO - payments & reports
delivery@ewald.com / 123456    # DELIVERY - delivery orders
```

### Charts (Reportes.jsx)
The reports page uses Recharts with:
- **TopProductosRanking**: Medal-based ranking (ğŸ¥‡ğŸ¥ˆğŸ¥‰) with progress bars
- **DonutChart**: For payment methods and order types
- **VentasPorMozoRanking**: Bar-based ranking for sales by waiter
